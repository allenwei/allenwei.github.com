
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Digruby</title>
	<meta name="author" content="Allen Wei">

	
	<meta name="description" content="Mar 30th, 2010 RubyOnRails, RubyOnRails, Tips, active_record, metaprograming Tips - Send Method Into Active Record If you want to enhance @ &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Digruby" type="application/atom+xml">
	
	<link rel="canonical" href="http://allenwei.github.io/blog/page/6/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("digruby@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>
<hgroup>
  <h1>Digruby</h1>
  
    <h2><a href="/">Allen Wei's Tech Notes</a></h2>
  
</hgroup>

<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/allenwei" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/allenwei" title="GitHub">GitHub</a>
		
		
		
		
		
		
		<a class="delicious" href="http://delicious.com/allenwei" title="Delicious">Delicious</a>
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-03-30T00:00:00+08:00" data-updated="true" itemprop="datePublished">Mar 30<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/active-record/'>active_record</a>, <a class='category' href='/blog/categories/metaprograming/'>metaprograming</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/03/30/tips-send-method-into-active-record/" itemprop="url">Tips - Send Method Into Active Record</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h4>If you want to enhance @ActiveRecord@, what you need do?</h4>

<p>Write a piece of code in @lib@ like this</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Usage</span>
</span><span class='line'><span class="c1"># =========</span>
</span><span class='line'><span class="c1"># class SomeModel</span>
</span><span class='line'><span class="c1">#   money :amount,:consideration_value</span>
</span><span class='line'><span class="c1"># end</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># options</span>
</span><span class='line'><span class="c1"># ========</span>
</span><span class='line'><span class="c1"># precision =&gt; 2</span>
</span><span class='line'><span class="c1"># delimiter =&gt; &quot;,&quot;</span>
</span><span class='line'><span class="k">module</span> <span class="nn">Moneyable</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
</span><span class='line'>    <span class="n">base</span><span class="o">.</span><span class="n">extend</span> <span class="no">ClassMethods</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">ClassMethods</span>
</span><span class='line'>    <span class="kp">include</span> <span class="o">::</span><span class="no">CurrencyRounding</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">money</span><span class="p">(</span><span class="o">*</span><span class="n">names</span><span class="p">)</span>
</span><span class='line'>      <span class="kp">include</span> <span class="no">CurrencyRounding</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">names</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">kind_of?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span>
</span><span class='line'>        <span class="n">options</span> <span class="o">=</span> <span class="n">names</span><span class="o">.</span><span class="n">pop</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">cattr_accessor</span> <span class="ss">:variables_need_format</span>
</span><span class='line'>      <span class="n">names</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span>  <span class="o">|</span><span class="nb">name</span><span class="o">|</span>
</span><span class='line'>        <span class="nb">self</span><span class="o">.</span><span class="n">variables_need_format</span> <span class="o">||=</span> <span class="o">[]</span>
</span><span class='line'>        <span class="nb">self</span><span class="o">.</span><span class="n">variables_need_format</span> <span class="o">&lt;&lt;</span> <span class="nb">name</span><span class="o">.</span><span class="n">to_sym</span>
</span><span class='line'>        <span class="n">define_method</span> <span class="s2">&quot;formatted_</span><span class="si">#{</span><span class="nb">name</span><span class="o">.</span><span class="n">to_s</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
</span><span class='line'>          <span class="n">nice_rounding_with_format</span><span class="p">(</span><span class="nb">send</span><span class="p">(</span><span class="nb">name</span><span class="p">),</span><span class="n">options</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then Hack @AcitveRecord@
puts code below in enviroment.rb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># in &#39;Rails::Initializer.run do |config|&#39; block</span>
</span><span class='line'><span class="c1"># if there is &#39;no config.after_initialize&#39; </span>
</span><span class='line'> <span class="n">config</span><span class="o">.</span><span class="n">after_initialize</span> <span class="k">do</span>
</span><span class='line'>    <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:include</span><span class="p">,</span> <span class="no">Moneyable</span><span class="p">)</span>
</span><span class='line'> <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-03-30T00:00:00+08:00" data-updated="true" itemprop="datePublished">Mar 30<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/configuration/'>configuration</a>, <a class='category' href='/blog/categories/load-order/'>load order</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/03/30/rails-configuration-load-order/" itemprop="url">Rails Configuration Load Order</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>As <a href="http://www.sekuda.com/rails_initialization_and_configuration_order">this blog post</a> said.</p>

<p>Rails configuration load order is:</p>

<h1>config/preinitializer.rb</h1>

<h1>config/environment.rb</h1>

<h1>config/environments/#{RAILS_ENV}.rb</h1>

<h1>plugin initialization</h1>

<h1>gem initialization</h1>

<h1>config/initializer/*.rb</h1>

<h1>all after_initialize blocks, in the order they were defined in (so same order as above)</h1>

<h1>any junk left below the Rails::Initializer.run call/block in environment.rb</h1>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-03-24T00:00:00+08:00" data-updated="true" itemprop="datePublished">Mar 24<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/capybara/'>capybara</a>, <a class='category' href='/blog/categories/cucumber/'>cucumber</a>, <a class='category' href='/blog/categories/integration-test/'>integration test</a>, <a class='category' href='/blog/categories/selenium/'>selenium</a>, <a class='category' href='/blog/categories/test/'>test</a>, <a class='category' href='/blog/categories/webrat/'>webrat</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/03/24/cucumber-capybara-what-we-need-for-rails-integration-test/" itemprop="url">Cucumber + Capybara - What We Need for Rails Integration Test</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h2>What&rsquo;s Capybara</h2>

<p>bq.  Capybara is a webrat alternative which aims to support all browser simulators.</p>

<p>  As you know, webrat can not run javascript on the webpage. In order to test javascript and AJAX based website we need install <a href="http://github.com/ph7/selenium-client">Selenium-client</a> and learn extra API and also some configuratons.</p>

<p>  <a href="http://github.com/jnicklas/capybara">Capybara</a> give your a full stack solution.
  You can use similar API drive webrat and selenium. And don&rsquo;t need worry about configuraton.</p>

<p>  What&rsquo;s more, <a href="http://github.com/jnicklas/capybara">Capybara</a> integrated <a href="http://github.com/jarib/celerity">Celerity</a> which is a JRuby wrapper around HtmlUnit &ndash; a headless Java browser with JavaScript support. As your expect it using the same API.</p>

<p>  <em>And the killer feature of Capybara is you can easily change driver it use for testing. Not only in config file but also in runtime.</em></p>

<h2>Why we need Cucumber</h2>

<p>  Before I introduce what is Cucumber, you need know what is <a href="http://behaviour-driven.org/.">BDD</a></p>

<p>bq. BDD is an evolution thinking behind TestDrivenDevelopment  and AcceptanceTestDrivenPlanning</p>

<p>  <em>You don&rsquo;t need worry about what the hell BDD is. After you start using Cucumber you will know. I promise.</em></p>

<p>  <a href="http://github.com/aslakhellesoy/cucumber">Cucumber</a> is allow you execute plain-text which written by BDD like format as automated tests.</p>

<p>  There are plenty of materials on the internet which you can learn Cucumber</p>

<p>  First place your need go is Ryan Bates&#8217; RailsCasts <a href="http://railscasts.com/episodes/155-beginning-with-Cucumber">Beginning with Cucumber</a>
  Then <a href="http://wiki.github.com/aslakhellesoy/cucumber/">official Wiki of Cucumber</a> will very helpful!!, and there also list some <a href="http://wiki.github.com/aslakhellesoy/cucumber/tutorials-and-related-blog-posts">blog posts</a> written by community</p>

<p>  I won&rsquo;t involve more about it. In my later blog post I will give you some tricks about using Cucumber.</p>

<h2>Using Cucumber and Capybara</h2>

<h3>Install</h3>

<p>Follow the instruction on Capybara:</p>

<p>Install as a gem
@sudo gem install capybara@</p>

<p>On OSX you may have to install libffi, you can install it via MacPorts with:
@sudo port install libffi@</p>

<p>And you also need install Cucumber
@sudo gem install cucumber@</p>

<h3>Generate basic Cucumber folder structure and configuratons</h3>

<p>Capybara is built to work nicely with Cucumber. You can easily generate Capybara style cucumber structure and configuraton.
@script/generate cucumber &mdash;capybara@</p>

<p>And maybe you also need install another gem named <a href="http://github.com/copiousfreetime/launchy">launchy</a> which is helper class for launching cross-platform applications in a fire and forget manner.
@sudo gem install launchy@</p>

<h3>Configuration</h3>

<h4>Available Configuration</h4>

<p>Actually after you run the generator, you don&rsquo;t need much more configuraton. Here I&rsquo;ll list some of configuraton you can set.</p>

<p>You can specify it in @features/support/env.rb@ file</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Capybara</span><span class="o">.</span><span class="n">run_server</span> <span class="o">=</span> <span class="kp">true</span> <span class="c1">#Whether start server when testing</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">.</span><span class="n">default_selector</span> <span class="o">=</span> <span class="ss">:xpath</span> <span class="c1">#default selector , you can change to :css</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">.</span><span class="n">default_wait_time</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1">#When we testing AJAX, we can set a default wait time</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">.</span><span class="n">ignore_hidden_elements</span> <span class="o">=</span> <span class="kp">false</span> <span class="c1">#Ignore hidden elements when testing, make helpful when you hide or show elements using javascript</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">.</span><span class="n">javascript_driver</span> <span class="o">=</span> <span class="ss">:culerity</span> <span class="c1">#default driver when you using @javascript tag</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Load rails test features</h4>

<p>You can put codes below in @features/support/env.rb@ file</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Before</span> <span class="k">do</span>
</span><span class='line'>  <span class="no">Fixtures</span><span class="o">.</span><span class="n">reset_cache</span>
</span><span class='line'>  <span class="n">fixtures_folder</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">RAILS_ROOT</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;fixtures&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">fixtures</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">[</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fixtures_folder</span><span class="p">,</span> <span class="s1">&#39;*.yml&#39;</span><span class="p">)</span><span class="o">].</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;.yml&#39;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="no">Fixtures</span><span class="o">.</span><span class="n">create_fixtures</span><span class="p">(</span><span class="n">fixtures_folder</span><span class="p">,</span> <span class="n">fixtures</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And change</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Cucumber</span><span class="p">:</span><span class="ss">:Rails</span><span class="o">::</span><span class="no">World</span><span class="o">.</span><span class="n">use_transactional_fixtures</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'><span class="no">DatabaseCleaner</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="ss">:truncation</span>
</span></code></pre></td></tr></table></div></figure>


<p>OK. For now we already finish configuration. we can start writing cucumber test</p>

<h3>How to run test under different testing driver</h3>

<p>As you know cucumber support <a href="http://wiki.github.com/aslakhellesoy/cucumber/tags">tags</a>
Capybara using tag to specify different driver, it supports  @@javascript, @selenium, @celerity, @culerity and @rack_test@ tags
You can use it like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="vi">@javascript</span>
</span><span class='line'>  <span class="ss">Scenario</span><span class="p">:</span> <span class="k">do</span> <span class="n">something</span> <span class="no">AJAXy</span>
</span><span class='line'>  <span class="no">When</span> <span class="n">I</span> <span class="n">click</span> <span class="n">the</span> <span class="no">AJAX</span> <span class="n">link</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>About how to write cucumber, you can check out <a href="http://wiki.github.com/aslakhellesoy/cucumber/">Cucumber Wiki</a></p>

<h3>About Capybara API</h3>

<p>What I want to show you is how&rsquo;s Capybara API look like.</p>

<p>This is all support Webrat like APIs in Capybara</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="no">DSL_METHODS</span> <span class="o">=</span> <span class="o">[</span>
</span><span class='line'>      <span class="ss">:all</span><span class="p">,</span> <span class="ss">:attach_file</span><span class="p">,</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">:check</span><span class="p">,</span> <span class="ss">:choose</span><span class="p">,</span> <span class="ss">:click</span><span class="p">,</span> <span class="ss">:click_button</span><span class="p">,</span> <span class="ss">:click_link</span><span class="p">,</span> <span class="ss">:current_url</span><span class="p">,</span> <span class="ss">:drag</span><span class="p">,</span> <span class="ss">:evaluate_script</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:field_labeled</span><span class="p">,</span> <span class="ss">:fill_in</span><span class="p">,</span> <span class="ss">:find</span><span class="p">,</span> <span class="ss">:find_button</span><span class="p">,</span> <span class="ss">:find_by_id</span><span class="p">,</span> <span class="ss">:find_field</span><span class="p">,</span> <span class="ss">:find_link</span><span class="p">,</span> <span class="ss">:has_content?</span><span class="p">,</span> <span class="ss">:has_css?</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:has_no_content?</span><span class="p">,</span> <span class="ss">:has_no_css?</span><span class="p">,</span> <span class="ss">:has_no_xpath?</span><span class="p">,</span> <span class="ss">:has_xpath?</span><span class="p">,</span> <span class="ss">:locate</span><span class="p">,</span> <span class="ss">:save_and_open_page</span><span class="p">,</span> <span class="ss">:select</span><span class="p">,</span> <span class="ss">:source</span><span class="p">,</span> <span class="ss">:uncheck</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:visit</span><span class="p">,</span> <span class="ss">:wait_until</span><span class="p">,</span> <span class="ss">:within</span><span class="p">,</span> <span class="ss">:within_fieldset</span><span class="p">,</span> <span class="ss">:within_table</span><span class="p">,</span> <span class="ss">:has_link?</span><span class="p">,</span> <span class="ss">:has_no_link?</span><span class="p">,</span> <span class="ss">:has_button?</span><span class="p">,</span> <span class="ss">:has_no_button?</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:has_field?</span><span class="p">,</span> <span class="ss">:has_no_field?</span><span class="p">,</span> <span class="ss">:has_checked_field?</span><span class="p">,</span> <span class="ss">:has_unchecked_field?</span><span class="p">,</span> <span class="ss">:has_no_table?</span><span class="p">,</span> <span class="ss">:has_table?</span><span class="p">,</span> <span class="ss">:unselect</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:has_select?</span><span class="p">,</span> <span class="ss">:has_no_select?</span>
</span><span class='line'>    <span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here are some examples which are not mentioned in Capybara Wiki.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="c1"># we can get page object from cucumber steps, page is an instance of @Capybara::Session@</span>
</span><span class='line'>  <span class="n">page</span><span class="o">.</span><span class="n">has_css?</span> <span class="s2">&quot;ul.error_messages li&quot;</span><span class="p">,</span> <span class="ss">:count</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot;error&quot;</span>
</span><span class='line'>  <span class="n">page</span><span class="o">.</span><span class="n">has_xpath?</span> <span class="s2">&quot;//ul[@class=&#39;error_messages&#39;]/li&quot;</span><span class="p">,</span> <span class="ss">:count</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot;error&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#Equivalent</span>
</span><span class='line'>  <span class="n">page</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span><span class="s2">&quot;ul.error_messages li&quot;</span><span class="p">,</span> <span class="ss">:count</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot;error&quot;</span>
</span><span class='line'>  <span class="n">page</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="ss">:xpath</span><span class="p">,</span><span class="s2">&quot;//ul[@class=&#39;error_messages&#39;]/li&quot;</span><span class="p">,</span> <span class="ss">:count</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot;error&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#Iterate all elements you found</span>
</span><span class='line'>  <span class="n">all</span><span class="p">(</span><span class="ss">:xpath</span><span class="p">,</span><span class="s2">&quot;//ul[@class=&#39;error_messages&#39;]/input&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">node</span><span class="o">|</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="n">node</span><span class="o">.</span><span class="n">[</span><span class="ss">:attribute_name</span><span class="o">]</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="n">node</span><span class="o">.</span><span class="n">click</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;aa&quot;</span><span class="p">)</span> <span class="c1">#set value</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>XPath</h3>

<p>If you want to use XPath in Capybara, you need caution string escape.
Capybara give us a good example</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">s</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">substr</span><span class="o">|</span>
</span><span class='line'>    <span class="s2">&quot;&#39;</span><span class="si">#{</span><span class="n">substr</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span class='line'>    <span class="k">end</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sx">%q{,&quot;&#39;&quot;,}</span><span class="p">)</span>
</span><span class='line'>    <span class="s2">&quot;concat(</span><span class="si">#{</span><span class="n">string</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="s2">&quot;&#39;</span><span class="si">#{</span><span class="n">string</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Summarize</h2>

<p>Cucumber + Capybara will make your integration test easilier.
Finally we find a full stack integration test.
Have fun with it!</p>

<p>Thanks <a href="http://github.com/aslakhellesoy">aslakhellesoy</a> and <a href="http://github.com/jnicklas">jnicklas</a></p>

<p>@PS:In this blog post I did memtion Celerity because I haven&rsquo;t tried it.@</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-03-19T00:00:00+08:00" data-updated="true" itemprop="datePublished">Mar 19<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/module/'>module</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/test/'>test</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/03/19/tips-how-to-test-a-module/" itemprop="url">Tips - How to Test a Module</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>   <span class="vi">@my_module</span> <span class="o">=</span> <span class="no">Object</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>   <span class="vi">@my_module</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="no">YourModule</span><span class="p">)</span>
</span><span class='line'>   <span class="c1">#Then test methods in a Module</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-03-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">Mar 2<span>nd</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/test/'>test</a>, <a class='category' href='/blog/categories/unittest/'>unittest</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/03/02/tips-print-test-name-and-file-name-when-testing/" itemprop="url">Tips - Print Test Name and File Name When Testing</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>-Deprecated-</p>

<p>See this <a href="/tips-print-test-name-and-file-name-when-testing-final-solution/">tips-print-test-name-and-file-name-when-testing-final-solution</a></p>

<p>Add following lines in @test/test_helper.rb@, under @class ActiveSupport::TestCase@</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="k">def</span> <span class="nf">setup</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;== </span><span class="si">#{</span><span class="vi">@method_name</span><span class="si">}</span><span class="s2"> : </span><span class="si">#{</span><span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> ==&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-02-18T00:00:00+08:00" data-updated="true" itemprop="datePublished">Feb 18<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/code-generate/'>code_generate</a>, <a class='category' href='/blog/categories/generator/'>generator</a>, <a class='category' href='/blog/categories/guide/'>guide</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/02/18/the-missing-guide-of-rails-2-generator-part-2/" itemprop="url">The Missing Guide of Rails 2 Generator Part 2</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>  Last post <a href="http://www.allenwei.cn/the-missing-guide-of-rails-2-generator-part-1/">The missing guide of rails 2 generator part 1</a> I showed you the basic knowledge about rails generator.</p>

<p>This post I&rsquo;ll show you another type of generator <a href="http://edgedocs.planetargon.org/classes/Rails/Generator/NamedBase.html">Named Geneerator</a></p>

<p>What&rsquo;s the different between basic generator and named generator?</p>

<p>Commonly it used by this kind of generate</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate generator_name hello attr1:value1</span></code></pre></td></tr></table></div></figure>


<h1>named generator will get first argument you passed in as name attribute, and what&rsquo;s more it convert name to 3 types of string plural_name,singular_name,table_name</h1>

<h1>For the reset of attributes will be parsed to <a href="http://api.rubyonrails.org/classes/Rails/Generator/GeneratedAttribute.html,">Rails::Generator::GeneratedAttribute</a> this class encapsulate you key-value pair.</h1>

<p>for the example above.
name attribute will be &ldquo;hello&rdquo;
reset of attribute will create one GeneratedAttribute instance whose name is attr1, type is value1.
You will think it is weird, yes. GeneratedAttribute is actually used for specify database column name and column type.</p>

<p>According to your reqirement, you can choose basic generator or named generator.</p>

<p>Keep DRY and using generator save your time.
 rails generator.</p>

<p>This post I&rsquo;ll show you another type of generator <a href="http://edgedocs.planetargon.org/classes/Rails/Generator/NamedBase.html">Named Geneerator</a></p>

<p>What&rsquo;s the different between basic generator and named generator?</p>

<p>Commonly it used by this kind of generate</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate generator_name hello attr1:value1</span></code></pre></td></tr></table></div></figure>


<h1>named generator will get first argument you passed in as name attribute, and what&rsquo;s more it convert name to 3 types of string plural_name,singular_name,table_name</h1>

<h1>For the reset of attributes will be parsed to <a href="http://api.rubyonrails.org/classes/Rails/Generator/GeneratedAttribute.html,">Rails::Generator::GeneratedAttribute</a> this class encapsulate you key-value pair.</h1>

<p>for the example above.
name attribute will be &ldquo;hello&rdquo;
reset of attribute will create one GeneratedAttribute instance whose name is attr1, type is value1.
You will think it is weird, yes. GeneratedAttribute is actually used for specify database column name and column type.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-02-18T00:00:00+08:00" data-updated="true" itemprop="datePublished">Feb 18<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/code-generate/'>code_generate</a>, <a class='category' href='/blog/categories/generator/'>generator</a>, <a class='category' href='/blog/categories/guide/'>guide</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/02/18/the-missing-guide-of-rails-2-generator-part-1/" itemprop="url">The Missing Guide of Rails 2 Generator Part 1</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>   When I try to find a guide about how to write rails generator, I can&rsquo;t find a good one. So I decide wrote one.
   Though Rails 3 will come, but I think people will keep using rails 2 for a long period.</p>

<p>Before we start you need know what is generator, rails provide many generator for us. You can type</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate</span></code></pre></td></tr></table></div></figure>


<p> in your RAILS_ROOT.
You will find there is rails builtin: controller, helper, integration_test, mailer, metal, migration, model, observer, performance_test, plugin, resource, scaffold, session_migration
I think the must familiar with some of these.</p>

<p>Write your own generator is very simple, let me show you.</p>

<p>Assuming we will create a hello generator</p>

<ol>
<li>create folder lib/generators/hello</li>
<li>create a ruby file lib/generators/hello/hello_generator.rb</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">HelloGenerator</span> <span class="o">&lt;</span> <span class="ss">Rails</span><span class="p">:</span><span class="ss">:Generator</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">manifest</span> <span class="c1"># this method is default entrance of generator</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;hello&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>3.run</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate hello</span></code></pre></td></tr></table></div></figure>


<p>, we print &ldquo;hello&rdquo;.</p>

<p>It is not enough, we need other function, like create folder, create file according to some template, copy file etc.
Rails is powerful. It support some basic command. I&rsquo;ll show you one by one.</p>

<ol>
<li>create folder, copy file</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">HelloGenerator</span> <span class="o">&lt;</span> <span class="ss">Rails</span><span class="p">:</span><span class="ss">:Generator</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">manifest</span> <span class="c1"># this method is default entrance of generator</span>
</span><span class='line'>    <span class="n">record</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="c1">#Convenience method for generator subclasses to record a manifest. </span>
</span><span class='line'>      <span class="n">m</span><span class="o">.</span><span class="n">directory</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span><span class="s2">&quot;view&quot;</span><span class="p">,</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">m</span><span class="o">.</span><span class="n">file</span> <span class="s2">&quot;relative_source&quot;</span><span class="p">,</span><span class="s2">&quot;relative_destination&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>create file according to template</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">HelloGenerator</span> <span class="o">&lt;</span> <span class="ss">Rails</span><span class="p">:</span><span class="ss">:Generator</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">manifest</span> <span class="c1"># this method is default entrance of generator</span>
</span><span class='line'>    <span class="n">record</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="c1">#Convenience method for generator subclasses to record a manifest. </span>
</span><span class='line'>      <span class="n">m</span><span class="o">.</span><span class="n">directory</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span><span class="s2">&quot;view&quot;</span><span class="p">,</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">m</span><span class="o">.</span><span class="n">template</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span><span class="s2">&quot;view&quot;</span><span class="p">,</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span><span class="s2">&quot;hello.html.erb&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>template is locate at your generator folder templates sub folder.</p>

<p>For the example above, we create hello.html.erb according to hello template.
hello template acctually is a erb file. you can put some ruby code there.
for example</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ul&gt;</span>
</span><span class='line'>  <span class="err">&lt;</span>% 3.times do |i| %&gt;
</span><span class='line'>  <span class="nt">&lt;li&gt;</span><span class="err">&lt;</span>%= i%&gt; times <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="err">&lt;</span>% end %&gt;
</span><span class='line'><span class="nt">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>After we know that, we do some fancy stuff, we can pass in some argument when we generate file.</p>

<p>Think how we generate controller using rails builtin generator.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate controller controller_name action1 action2</span></code></pre></td></tr></table></div></figure>


<p>we can do the same think. But how we get the argument in generator?
Assuming we call our generator using</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate hello china world</span></code></pre></td></tr></table></div></figure>


<p>we can get argument in generator from attribute</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>args</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">HelloGenerator</span> <span class="o">&lt;</span> <span class="ss">Rails</span><span class="p">:</span><span class="ss">:Generator</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">manifest</span> <span class="c1"># this method is default entrance of generator </span>
</span><span class='line'>    <span class="n">record</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="c1">#Convenience method for generator subclasses to record a manifest. </span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">args</span><span class="o">.</span><span class="n">inspect</span> <span class="c1"># [&quot;china&quot;,&quot;world&quot;]</span>
</span><span class='line'>      <span class="n">m</span><span class="o">.</span><span class="n">directory</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span><span class="s2">&quot;view&quot;</span><span class="p">,</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">args</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">word</span><span class="o">|</span>
</span><span class='line'>        <span class="n">m</span><span class="o">.</span><span class="n">template</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span><span class="s2">&quot;view&quot;</span><span class="p">,</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">word</span><span class="si">}</span><span class="s2">.html.erb&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>How we pass variable to template file?</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">HelloGenerator</span> <span class="o">&lt;</span> <span class="ss">Rails</span><span class="p">:</span><span class="ss">:Generator</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">manifest</span>
</span><span class='line'>    <span class="n">record</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
</span><span class='line'>      <span class="n">m</span><span class="o">.</span><span class="n">template</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span><span class="s2">&quot;view&quot;</span><span class="p">,</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span><span class="s2">&quot;hello.html.erb&quot;</span><span class="p">),</span><span class="ss">:assigns</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:var1</span> <span class="o">=&gt;</span> <span class="s2">&quot;var1&quot;</span><span class="p">,</span><span class="ss">:var2</span> <span class="o">=&gt;</span> <span class="s2">&quot;var2&quot;</span><span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>OK, this is magic time. call this command</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/destroy hello china world</span></code></pre></td></tr></table></div></figure>


<p>See rails delete the resource we created using generator. Even if we didn&rsquo;t write any extra code for it.</p>

<ol>
<li>how we know it&rsquo;s create or destroy, you can get it from</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>options[:command]</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">HelloGenerator</span> <span class="o">&lt;</span> <span class="ss">Rails</span><span class="p">:</span><span class="ss">:Generator</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">manifest</span> <span class="c1"># this method is default entrance of generator </span>
</span><span class='line'>    <span class="n">record</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="c1">#Convenience method for generator subclasses to record a manifest. </span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">options</span><span class="o">[</span><span class="ss">:command</span><span class="o">]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>More command rails generator support see <a href="http://api.rubyonrails.org/classes/Rails/Generator/Commands/Create.html">http://api.rubyonrails.org/classes/Rails/Generator/Commands/Create.html</a></p>

<p>Next part I will introduce another generator Named Generator.
like how we create scaffold</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate scaffold user name:string age:integer</span></code></pre></td></tr></table></div></figure>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-02-15T00:00:00+08:00" data-updated="true" itemprop="datePublished">Feb 15<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/hash/'>hash</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/symbolize-keys/'>symbolize_keys</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/02/15/why-we-can-get-params-values-by-both-symbol-and-string/" itemprop="url">Why We Can Get Params Values by Both Symbol and String</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Today, I met a weird bug converting <a href="http://apidock.com/rails/Rack/Request/params">params</a> to a hash only has symbol keys.</p>

<p>I see there is a method which in ActiveSupport. <a href="http://apidock.com/rails/HashWithIndifferentAccess/symbolize_keys!,">symbolize_keys!</a> convert all keys of hash to symbol.</p>

<p>So I did this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">some_action</span>
</span><span class='line'>  <span class="n">params</span><span class="o">.</span><span class="n">symbolize_keys!</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>But after print params, I found</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>symbolize_keys!</span></code></pre></td></tr></table></div></figure>


<p> doesn&rsquo;t work. The keys in <a href="http://apidock.com/rails/Rack/Request/params">params</a> still</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>String</span></code></pre></td></tr></table></div></figure>


<p>.</p>

<p>After some googling, I find that class of <a href="http://apidock.com/rails/Rack/Request/params">params</a> is not hash, it is <a href="http://apidock.com/rails/HashWithIndifferentAccess">HashWithIndifferentAccess</a></p>

<p>Then I find</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>symbolize_keys!</span></code></pre></td></tr></table></div></figure>


<p> method just return</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>self</span></code></pre></td></tr></table></div></figure>


<p>The description of this class is:
bq. This class has dubious semantics and we only have it so that people can write params[:key] instead of params[key] and they get the same value for both keys.</p>

<p>I realized that&rsquo;s why we can get values from <a href="http://apidock.com/rails/Rack/Request/params">params</a> by both</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Symbol</span></code></pre></td></tr></table></div></figure>


<p> and</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>String</span></code></pre></td></tr></table></div></figure>


<p>So You can also use this powerful tool:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">h</span> <span class="o">=</span> <span class="no">HashWithIndifferentAccess</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="n">h</span><span class="o">[</span><span class="s2">&quot;allen&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;wei&quot;</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">h</span><span class="o">[</span><span class="s2">&quot;allen&quot;</span><span class="o">]</span> <span class="c1"># print &quot;wei&quot;</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">h</span><span class="o">[</span><span class="ss">:allen</span><span class="o">]</span>  <span class="c1"># print &quot;wei&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You don&rsquo;t need  <a href="http://apidock.com/rails/HashWithIndifferentAccess/symbolize_keys!.">symbolize_keys!</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-02-15T00:00:00+08:00" data-updated="true" itemprop="datePublished">Feb 15<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/partial/'>partial</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/02/15/tips-variable-in-partial-defined/" itemprop="url">Tips - Variable in Partial Defined?</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>When we use variabel in partial, we will meet constant undefined error. How to avoid?  <code>ruby&lt;% if foo.nil? %&gt;</code> doesn&rsquo;t work</p>

<p>assuming variable <em>foo</em>
There are two ways:</p>

<h1></h1>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">local_assigns</span>
</span></code></pre></td></tr></table></div></figure>


<p> will get all local variables, using</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">local_assigns</span><span class="o">[</span><span class="ss">:foo</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>,we can get variable value, If this variable is undefined, it will return</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nil</span></code></pre></td></tr></table></div></figure>


<p>. Not Error.</p>

<h1></h1>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">defined?</span>
</span></code></pre></td></tr></table></div></figure>


<p> method
Using</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">defined?</span> <span class="ss">:foo</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2010-02-15T00:00:00+08:00" data-updated="true" itemprop="datePublished">Feb 15<span>th</span>, 2010</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/rubyonrails/'>RubyOnRails</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/activerecord/'>activerecord</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2010/02/15/tips-using-symbol-in-activerecord-find/" itemprop="url">Tips - Using Symbol in ActiveRecord Find</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>before</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Account</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="ss">:all</span><span class="p">,</span> <span class="ss">:conditions</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;name LIKE ? AND updated_at &lt; ?&#39;</span><span class="p">,</span> <span class="s2">&quot;aname&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="o">.</span><span class="n">days</span><span class="o">.</span><span class="n">ago</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>After</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Account</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="ss">:all</span><span class="p">,</span> <span class="ss">:conditions</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;name LIKE :name AND updated_at &lt; :date&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">&quot;aname&quot;</span><span class="p">,</span> <span class="ss">:date</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="o">.</span><span class="n">days</span><span class="o">.</span><span class="n">ago</span><span class="p">}</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
        <a href="/blog/page/5/" class="prev">Prev</a>
    
    
        <a href="/blog/page/7/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - Allen Wei -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			

<script type="text/javascript">
      var disqus_shortname = 'digrubycom';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





		</div>
	</div>
</body>
</html>
